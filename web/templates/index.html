<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–õ–µ–æ ‚Äî –ì–ª–∞–≤–Ω–∞—è</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">

  <!-- –®—Ä–∏—Ñ—Ç—ã -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="/static/css/main.css?v=14" />

  <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ–≤–∞–ª–∞ –∏ —à–∞–ø–∫–∏ -->
  <style>
    /* === –ì–õ–û–ë–ê–õ–¨–ù–´–ô –°–ë–†–û–° === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      min-height: 100vh;
      overflow-x: hidden; /* üî• –£–±–∏—Ä–∞–µ–º –ø–æ–ª–æ—Å—É */
      font-family: 'Inter', sans-serif;
      background: #f0fff0;
      color: #212121;
    }

    /* === –û–í–ê–õ –° "–õ–ï–û" === */
    .leo-badge-3d {
      position: fixed;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 130px;
      height: 62px;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      border-radius: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3), 0 0 0 1.5px #FFD700;
      font-family: 'Inter', sans-serif;
      text-align: center;
      z-index: 1002;
      border: 1.5px solid #FFD700;
      transition: all 0.3s ease;
      animation: float 3s ease-in-out infinite;
      pointer-events: auto;
    }

    @keyframes float {
      0% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-1.5px); }
      100% { transform: translateX(-50%) translateY(0); }
    }

    .leo-logo {
      display: flex;
      align-items: center;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -1px;
    }

    .leo-logo .l {
      color: #8B4513;
      font-size: 22px;
      position: relative;
    }

    .leo-logo .l::before,
    .leo-logo .l::after {
      content: '';
      position: absolute;
      width: 7px;
      height: 8px;
      background: #8B4513;
      bottom: -7px;
      border-radius: 40% 40% 60% 60%;
    }

    .leo-logo .l::before {
      left: 2px;
      transform: rotate(30deg);
      width: 6px;
      height: 7px;
    }

    .leo-logo .l::after {
      right: 2px;
      transform: rotate(-30deg);
      width: 6px;
      height: 7px;
    }

    .leo-logo .eo {
      color: #FFD700;
      font-size: 18px;
      position: relative;
    }

    .leo-logo .eo::before {
      content: '';
      position: absolute;
      top: -5px;
      left: -3px;
      width: 10px;
      height: 10px;
      background: #4CAF50;
      border-radius: 50%;
      box-shadow: 
        7px -2px 0 1px #4CAF50,
        3px -5px 0 1px #4CAF50,
        10px 1px 0 1px #4CAF50;
    }

    .page-tag {
      font-size: 12px;
      font-weight: 500;
      background: rgba(255, 215, 0, 0.25);
      padding: 1px 6px;
      border-radius: 10px;
      border: 1px solid rgba(255, 215, 0, 0.4);
      color: white;
      white-space: nowrap;
    }

    /* === –ü–†–û–ó–†–ê–ß–ù–ê–Ø –®–ê–ü–ö–ê === */
    .full-header {
      position: fixed;
      top: 0;
      left: 10px;
      width: calc(100% - 20px);
      height: 60px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border-bottom-left-radius: 16px;
      border-bottom-right-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 1001;
      transition: all 0.3s ease;
    }

    .header-left,
    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn-icon {
      background: transparent;
      border: none;
      color: #2E7D32;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: rgba(76, 175, 80, 0.1);
    }

    /* === –û–¢–°–¢–£–ü –î–õ–Ø –ö–û–ù–¢–ï–ù–¢–ê === */
    .main-content {
      margin-top: 90px; /* –ø–æ–¥ –æ–≤–∞–ª –∏ —à–∞–ø–∫—É */
      padding: 0 16px;
    }
  </style>
</head>
<body>

  <!-- –û–≤–∞–ª —Å "–õ–µ–æ" -->
  <div class="leo-badge-3d" id="leo-badge">
    <div class="leo-logo">
      <span class="l">–õ</span><span class="eo">–µ–æ</span>
    </div>
    <div class="page-tag">–ì–ª–∞–≤–Ω–∞—è</div>
  </div>

  <!-- –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —à–∞–ø–∫–∞ -->
  <div class="full-header" id="main-header">
    <div class="header-left">
      <button class="btn-icon" onclick="toggleSidebar()" aria-label="–ú–µ–Ω—é">
        <span class="material-icons">menu</span>
      </button>
      <button class="btn-icon" onclick="history.back()" aria-label="–ù–∞–∑–∞–¥">
        <span class="material-icons">arrow_back</span>
      </button>
    </div>
    <div class="header-right">
      <button class="btn-icon" onclick="toggleTheme()" aria-label="–¢–µ–º–∞">
        <span class="material-icons" id="theme-icon">dark_mode</span>
      </button>
    </div>
  </div>

  <!-- –°–∞–π–¥–±–∞—Ä (–æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –µ—Å—Ç—å) -->
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <span class="logo-icon">üå±</span>
      <span class="logo-text">–õ–µ–æ</span>
    </div>
    <nav>
      <a href="#" class="nav-link active" onclick="navigateTo('dashboard'); toggleSidebar()">
        <span class="material-icons">dashboard</span> –ì–ª–∞–≤–Ω–∞—è
      </a>
      <a href="/finance?user_id={{ user.id }}&hash={{ request.query_params.hash }}" class="nav-link" onclick="toggleSidebar()">
        <span class="material-icons">account_balance_wallet</span> –§–∏–Ω–∞–Ω—Å—ã
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('weather'); toggleSidebar()">
        <span class="material-icons">wb_sunny</span> –ü–æ–≥–æ–¥–∞
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('gigachat'); toggleSidebar()">
        <span class="material-icons">smart_toy</span> GigaChat
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('premium'); toggleSidebar()">
        <span class="material-icons">star</span> –ü—Ä–µ–º–∏—É–º
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('support'); toggleSidebar()">
        <span class="material-icons">help</span> –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      </a>
      {% if user.role == 'admin' %}
      <a href="#" id="admin-link" class="nav-link" onclick="navigateTo('admin'); toggleSidebar()">
        <span class="material-icons">admin_panel_settings</span> –ê–¥–º–∏–Ω–∫–∞
      </a>
      {% endif %}
    </nav>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –µ—Å—Ç—å) -->
  <div class="main-content">
    <header>
      <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
      <div>
        <span id="greeting">–î–æ–±—Ä—ã–π –¥–µ–Ω—å</span>, 
        <span id="user-name">{{ user.first_name|default('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', true) }}</span>
        <span id="mood-icon">üå§</span>
      </div>
      <div class="header-icons">
        <span class="material-icons" onclick="openNotifications()">notifications</span>
        <div class="avatar">{{ (user.first_name[0]|upper) if user.first_name else 'U' }}</div>
      </div>
    </header>

    <div class="container">
      <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
      <div class="card highlight" id="welcome-card">
        <div class="subscription-badge" id="sub-badge">–ë–∞–∑–æ–≤–∞—è</div>
        <h2>üå± –î–æ–±—Ä–æ –ø–æ–∂–µ–ª–æ–≤–∞—Ç—å –≤ –õ–µ–æ</h2>
        <p>–í–∞—à –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ Telegram. –ó–¥–µ—Å—å ‚Äî –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ.</p>
        <button class="btn-primary" onclick="navigateTo('premium')">
          {{ '–£–ø—Ä–∞–≤–ª—è—Ç—å' if user.is_premium else '–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–º–∏—É–º' }}
        </button>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
      <div class="section-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
      <div class="button-grid">
        <a href="/finance?user_id={{ user.id }}&hash={{ request.query_params.hash }}" class="action-btn">
          <div class="action-icon">üí∞</div>
          <div class="action-label">–§–∏–Ω–∞–Ω—Å—ã</div>
        </a>
        <a href="#" class="action-btn" onclick="navigateTo('weather')">
          <div class="action-icon">üå¶</div>
          <div class="action-label">–ü–æ–≥–æ–¥–∞</div>
        </a>
        <a href="#" class="action-btn" onclick="navigateTo('gigachat')">
          <div class="action-icon">üí¨</div>
          <div class="action-label">GigaChat</div>
        </a>
        <a href="#" class="action-btn" onclick="navigateTo('games')">
          <div class="action-icon">üéÆ</div>
          <div class="action-label">–ò–≥—Ä—ã</div>
        </a>
      </div>

      <!-- –í–∏–¥–∂–µ—Ç—ã -->
      <div class="widget-grid">
        <div class="widget weather-widget">
          <div class="widget-icon">üå§</div>
          <div class="widget-title">–ü–æ–≥–æ–¥–∞</div>
          <div class="widget-value"><span id="current-temp">+12¬∞C</span></div>
          <div class="widget-sub">–≤ –ú–æ—Å–∫–≤–µ</div>
        </div>
        <div class="widget currency-widget">
          <div class="widget-icon">üíµ</div>
          <div class="widget-title">–ö—É—Ä—Å USD</div>
          <div class="widget-value"><span id="usd-rate">98.50</span> ‚ÇΩ</div>
          <div class="widget-sub">–Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class="widget chat-widget">
          <div class="widget-icon">ü§ñ</div>
          <div class="widget-title">GigaChat</div>
          <div class="widget-value">{{ user.gigachat_requests or 0 }}/10</div>
          <div class="widget-sub">–∑–∞–ø—Ä–æ—Å–æ–≤</div>
        </div>
        <div class="widget reminder-widget">
          <div class="widget-icon">üõé</div>
          <div class="widget-title">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
          <div class="widget-value">{{ user.reminders or 2 }}</div>
          <div class="widget-sub">–∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
        </div>
      </div>

      <!-- –ù–æ–≤–æ—Å—Ç–∏ -->
      <div class="section-title">üì∞ –ù–æ–≤–æ—Å—Ç–∏ –¥–Ω—è</div>
      <div class="news-feed" id="news-feed"></div>
      <div class="news-footer">
        <button class="btn-sm" onclick="loadMoreNews()">–ï—â—ë –Ω–æ–≤–æ—Å—Ç–∏</button>
      </div>
    </div>
  </div>

  <!-- FAB –∏ –û–≤–µ—Ä–ª–µ–π -->
  <button class="fab" onclick="navigateTo('gigachat')">üí¨</button>
  <div class="overlay" onclick="toggleSidebar()"></div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã -->
  <script src="/static/js/main.js?v=10"></script>
  <script>
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const userData = {
      id: {{ user.id if user.id else 'null' }},
      firstName: "{{ user.first_name|default('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', true) }}",
      isPremium: {{ "true" if user.is_premium else "false" }},
      role: "{{ user.role|default('user', true) }}",
      gigachat_requests: {{ user.gigachat_requests if user.gigachat_requests else 0 }},
      reminders: {{ user.reminders if user.reminders else 2 }}
    };

    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    function updateGreeting() {
      const hour = new Date().getHours();
      const map = { 5: "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ", 12: "–î–æ–±—Ä—ã–π –¥–µ–Ω—å", 18: "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä", 22: "–î–æ–±—Ä–æ–π –Ω–æ—á–∏" };
      const icons = { 5: "‚òÄÔ∏è", 12: "üå§", 18: "üåô", 22: "üò¥" };
      let g = "–ü—Ä–∏–≤–µ—Ç", i = "üôÇ";
      for (const h in map) if (hour >= h) { g = map[h]; i = icons[h]; }
      document.getElementById('greeting').textContent = g;
      document.getElementById('mood-icon').textContent = i;
    }

    // –ü–æ–¥–ø–∏—Å–∫–∞
    const badge = document.getElementById('sub-badge');
    if (badge) {
      if (userData.isPremium) {
        badge.textContent = '–ü—Ä–µ–º–∏—É–º';
        badge.classList.add('premium');
      } else {
        badge.textContent = '–ë–∞–∑–æ–≤–∞—è';
      }
    }

    // –ê–¥–º–∏–Ω–∫–∞
    if (userData.role === 'admin' && document.getElementById('admin-link')) {
      document.getElementById('admin-link').style.display = 'flex';
    }

    // –ù–æ–≤–æ—Å—Ç–∏
    const mockNews = [
      { icon: "üåç", title: "–ö—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –ø—Ä–µ–≤—ã—Å–∏–ª 99 —Ä—É–±–ª–µ–π", time: "10 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
      { icon: "ü§ñ", title: "Sber –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é GigaChat", time: "35 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
      { icon: "üå§", title: "–í –ú–æ—Å–∫–≤–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ –¥–æ +14¬∞C", time: "1 —á–∞—Å –Ω–∞–∑–∞–¥" },
      { icon: "üí∞", title: "–¶–ë –†–§ –æ–±—ä—è–≤–∏–ª –æ –Ω–æ–≤—ã—Ö –º–µ—Ä–∞—Ö –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä—É–±–ª—è", time: "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" },
      { icon: "üì±", title: "Telegram –æ–±–Ω–æ–≤–∏–ª —Ñ—É–Ω–∫—Ü–∏—é Mini Apps", time: "3 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" },
      { icon: "‚ö°", title: "–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –≤ –†–§", time: "4 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" }
    ];

    function renderNews(count = 3) {
      const container = document.getElementById('news-feed');
      if (!container) return;
      container.innerHTML = '';
      const toShow = mockNews.slice(0, count);
      toShow.forEach(news => {
        const item = document.createElement('div');
        item.className = 'news-item';
        item.innerHTML = `
          <div class="news-icon">${news.icon}</div>
          <div class="news-content">
            <div class="news-title">${news.title}</div>
            <div class="news-time">${news.time}</div>
          </div>
        `;
        container.appendChild(item);
      });
    }

    function loadMoreNews() {
      const currentCount = document.querySelectorAll('.news-item').length;
      const nextCount = Math.min(currentCount + 3, mockNews.length);
      renderNews(nextCount);
    }

    // –°–º–µ–Ω–∞ —Ç–µ–º—ã
    function toggleTheme() {
      const html = document.documentElement;
      const icon = document.getElementById('theme-icon');
      const isDark = html.getAttribute('data-theme') === 'dark';

      if (isDark) {
        html.setAttribute('data-theme', 'light');
        icon.textContent = 'dark_mode';
        localStorage.setItem('theme', 'light');
      } else {
        html.setAttribute('data-theme', 'dark');
        icon.textContent = 'light_mode';
        localStorage.setItem('theme', 'dark');
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      updateGreeting();
      renderNews(3);

      // –¢–µ–º–∞
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      const icon = document.getElementById('theme-icon');
      if (icon) {
        icon.textContent = savedTheme === 'dark' ? 'light_mode' : 'dark_mode';
      }
    });
  </script>
</body>
</html>