{% extends "base.html" %}

{% block styles %}
<style>
:root {
  --bg: transparent;
  --card-bg: rgba(255, 255, 255, 0.95);
  --text: #212121;
  --text-secondary: #757575;
  --border: rgba(178, 255, 89, 0.2);
  --accent: #4CAF50;
  --accent-light: #B2FF59;
  --gold: linear-gradient(-45deg, #DAA520, #FFD700, #F4C430, #C5B358, #DAA520);
  --gold-soft: linear-gradient(-45deg, #D4A017, #E6C229, #F4C430, #D4A017);
  --radius-sm: 8px;
  --radius-md: 16px;
  --radius-lg: 24px;
  --shadow: 0 6px 20px rgba(76, 175, 80, 0.08);
  --shadow-hover: 0 12px 28px rgba(76, 175, 80, 0.16), 0 16px 40px rgba(0, 0, 0, 0.12);
  --transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

[data-theme="dark"] {
  --bg: transparent;
  --card-bg: rgba(30, 30, 30, 0.95);
  --text: #ffffff;
  --text-secondary: #b0b0b0;
  --border: rgba(178, 255, 89, 0.1);
}

body, html {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  background: linear-gradient(135deg, #f0fff0, #d9f7d9, #e6ffeb);
  background-size: 400% 400%;
  animation: gradient-shift 15s ease infinite;
  min-height: 100vh;
  overflow-x: hidden;
}

[data-theme="dark"] body {
  background: linear-gradient(135deg, #0a1e0a, #0c240c, #0d2a0d);
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* === –û–°–ù–û–í–ù–´–ï –ö–ê–†–¢–´ === */
.card {
  background: var(--card-bg);
  border-radius: var(--radius-md);
  padding: 24px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  margin-bottom: 20px;
  transition: transform var(--transition);
}

.card:hover {
  transform: translateY(-2px);
}

/* === –í–ò–î–ñ–ï–¢–´ === */
.button-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-bottom: 30px;
}

.action-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 16px;
  text-align: center;
  color: var(--text);
  text-decoration: none;
  transition: background 0.3s ease;
}

.action-btn:hover {
  background: rgba(76, 175, 80, 0.05);
}

.action-icon {
  font-size: 28px;
  margin-bottom: 8px;
}

.action-label {
  font-size: 15px;
  font-weight: 500;
}

.detailed-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  margin-bottom: 30px;
}

.detailed-card {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 16px;
  font-size: 14px;
}

.detailed-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}

.card-header {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--accent);
  font-weight: 500;
  margin-bottom: 12px;
  font-size: 15px;
}

.temp-large {
  font-size: 24px;
  font-weight: 700;
  color: var(--text);
}

.weather-desc {
  font-size: 14px;
  color: var(--text-secondary);
  margin: 8px 0;
}

.weather-more {
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: 12px;
  color: var(--text-secondary);
}

@media (min-width: 768px) {
  .detailed-grid {
    grid-template-columns: 1fr 1fr;
  }
}

/* === –ù–û–í–û–°–¢–ò === */
.news-feed {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.news-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--card-bg);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
}

.news-icon {
  font-size: 24px;
}

.news-content {
  flex: 1;
}

.news-title {
  font-size: 15px;
  font-weight: 500;
  margin: 0 0 4px 0;
}

.news-time {
  font-size: 12px;
  color: var(--text-secondary);
  margin: 0;
}

.news-footer {
  text-align: center;
  margin: 16px 0;
}

/* === –ü–û–î–ü–ò–°–ö–ê === */
.subscription-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.subscription-badge.premium {
  background: var(--gold);
  background-size: 400% 400%;
  animation: shimmer-gold-strong 6s ease-in-out infinite;
  box-shadow: 0 2px 8px rgba(218, 165, 32, 0.3);
}

@keyframes shimmer-gold-strong {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>
{{ super() }}
{% endblock %}

{% block content %}
  {% include "components/header.html" %}

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      setPageTitle("–ö–∞–±–∏–Ω–µ—Ç");
    });
  </script>

  <div class="container">
    <div class="card highlight" id="welcome-card">
      <div class="subscription-badge" id="sub-badge">–ë–∞–∑–æ–≤–∞—è</div>
      <h2>üå± –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –õ–µ–æ</h2>
      <p>–í–∞—à –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ Telegram. –ó–¥–µ—Å—å ‚Äî –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ.</p>
      <button class="btn btn-primary" onclick="navigateTo('premium')">
        {{ '–£–ø—Ä–∞–≤–ª—è—Ç—å' if user.is_premium else '–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–º–∏—É–º' }}
      </button>
    </div>

    <div class="section-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
    <div class="button-grid">
      <a href="/finance?user_id={{ user.id }}&hash={{ request.query_params.hash }}" class="action-btn">
        <div class="action-icon">üí∞</div>
        <div class="action-label">–§–∏–Ω–∞–Ω—Å—ã</div>
      </a>
      <a href="#" class="action-btn" onclick="navigateTo('weather')">
        <div class="action-icon">üå¶</div>
        <div class="action-label">–ü–æ–≥–æ–¥–∞</div>
      </a>
      <a href="#" class="action-btn" onclick="navigateTo('gigachat')">
        <div class="action-icon">üí¨</div>
        <div class="action-label">GigaChat</div>
      </a>
      <a href="#" class="action-btn" onclick="navigateTo('games')">
        <div class="action-icon">üéÆ</div>
        <div class="action-label">–ò–≥—Ä—ã</div>
      </a>
    </div>

    <div class="detailed-grid">
      <div class="detailed-card weather-card">
        <div class="card-header">
          <span class="material-icons">wb_sunny</span>
          <span>–ü–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ</span>
        </div>
        <div class="card-body">
          <div class="temp-large">+14¬∞C</div>
          <div class="weather-desc">–û–±–ª–∞—á–Ω–æ, –±–µ–∑ –æ—Å–∞–¥–∫–æ–≤</div>
          <div class="weather-more">
            <span>–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ +12¬∞C</span>
            <span>–í–ª–∞–∂–Ω–æ—Å—Ç—å: 65%</span>
          </div>
        </div>
      </div>

      <div class="detailed-card currency-card">
        <div class="card-header">
          <span class="material-icons">trending_up</span>
          <span>–ö—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞</span>
        </div>
        <div class="card-body">
          <div class="temp-large">98.72 ‚ÇΩ</div>
          <div class="weather-desc">–¶–ë –†–§, —Å–µ–≥–æ–¥–Ω—è</div>
          <div class="weather-more">
            <span>–ò–∑–º. –∑–∞ –¥–µ–Ω—å: +0.25 ‚ÇΩ</span>
            <span>–ú–∞–∫—Å. –∑–∞ –Ω–µ–¥–µ–ª—é: 99.40 ‚ÇΩ</span>
          </div>
        </div>
      </div>
    </div>

    <div class="section-title">üì∞ –ù–æ–≤–æ—Å—Ç–∏ –¥–Ω—è</div>
    <div class="news-feed" id="news-feed"></div>
    <div class="news-footer">
      <button class="btn btn-sm" style="width: 100%;" onclick="loadMoreNews()">‚ö° –ï—â—ë –Ω–æ–≤–æ—Å—Ç–∏</button>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    const userData = {
      id: {{ user.id }},
      firstName: "{{ user.first_name|default('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', true) }}",
      isPremium: {{ "true" if user.is_premium else "false" }},
      role: "{{ user.role|default('user', true) }}"
    };

    const badge = document.getElementById('sub-badge');
    if (badge) {
      if (userData.isPremium) {
        badge.textContent = '–ü—Ä–µ–º–∏—É–º';
        badge.classList.add('premium');
      } else {
        badge.textContent = '–ë–∞–∑–æ–≤–∞—è';
      }
    }

    const mockNews = [
      { icon: "üåç", title: "–ö—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –ø—Ä–µ–≤—ã—Å–∏–ª 99 —Ä—É–±–ª–µ–π", time: "10 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
      { icon: "ü§ñ", title: "Sber –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é GigaChat", time: "35 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
      { icon: "üå§", title: "–í –ú–æ—Å–∫–≤–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ –¥–æ +14¬∞C", time: "1 —á–∞—Å –Ω–∞–∑–∞–¥" }
    ];

    function renderNews(count = 3) {
      const container = document.getElementById('news-feed');
      if (!container) return;
      container.innerHTML = '';
      const toShow = mockNews.slice(0, count);
      toShow.forEach(news => {
        const item = document.createElement('div');
        item.className = 'news-item';
        item.innerHTML = `
          <div class="news-icon">${news.icon}</div>
          <div class="news-content">
            <div class="news-title">${news.title}</div>
            <div class="news-time">${news.time}</div>
          </div>
        `;
        container.appendChild(item);
      });
    }

    function loadMoreNews() {
      const currentCount = document.querySelectorAll('.news-item').length;
      const nextCount = Math.min(currentCount + 3, mockNews.length);
      renderNews(nextCount);
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateGreeting();
      renderNews(3);
      Toast.info('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + userData.firstName + '!');
    });

    function updateGreeting() {
      const hour = new Date().getHours();
      const map = { 5: "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ", 12: "–î–æ–±—Ä—ã–π –¥–µ–Ω—å", 18: "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä", 22: "–î–æ–±—Ä–æ–π –Ω–æ—á–∏" };
      const icons = { 5: "‚òÄÔ∏è", 12: "üå§", 18: "üåô", 22: "üò¥" };
      let g = "–ü—Ä–∏–≤–µ—Ç", i = "üôÇ";
      for (const h in map) if (hour >= h) { g = map[h]; i = icons[h]; }
      document.getElementById('greeting')?.textContent = g;
      document.getElementById('mood-icon')?.textContent = i;
    }
  </script>
{% endblock %}