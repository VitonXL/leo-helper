<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–õ–µ–æ –ü–æ–º–æ—â–Ω–∏–∫ ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/main.css?v=9" />
</head>
<body>

  <!-- –°–∞–π–¥–±–∞—Ä (—Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è) -->
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <span class="logo-icon">üå±</span>
      <span class="logo-text">–õ–µ–æ</span>
    </div>
    <nav>
      <a href="#" class="nav-link active" onclick="navigateTo('dashboard'); toggleSidebar()">
        <span class="material-icons">dashboard</span> –ì–ª–∞–≤–Ω–∞—è
      </a>
      <a href="/finance?user_id={{ user.id }}&hash={{ request.query_params.hash }}" class="nav-link" onclick="toggleSidebar()">
        <span class="material-icons">account_balance_wallet</span> –§–∏–Ω–∞–Ω—Å—ã
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('weather'); toggleSidebar()">
        <span class="material-icons">wb_sunny</span> –ü–æ–≥–æ–¥–∞
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('gigachat'); toggleSidebar()">
        <span class="material-icons">smart_toy</span> GigaChat
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('premium'); toggleSidebar()">
        <span class="material-icons">star</span> –ü—Ä–µ–º–∏—É–º
      </a>
      <a href="#" class="nav-link" onclick="navigateTo('support'); toggleSidebar()">
        <span class="material-icons">help</span> –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      </a>
      {% if user.role == 'admin' %}
      <a href="#" id="admin-link" class="nav-link" onclick="navigateTo('admin'); toggleSidebar()">
        <span class="material-icons">admin_panel_settings</span> –ê–¥–º–∏–Ω–∫–∞
      </a>
      {% endif %}
    </nav>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="main-content">
    <header>
      <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
      <div>
        <span id="greeting">–î–æ–±—Ä—ã–π –¥–µ–Ω—å</span>, 
        <span id="user-name">{{ user.first_name|default('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', true) }}</span>
        <span id="mood-icon">üå§</span>
      </div>
      <div class="header-icons">
        <span class="material-icons" onclick="openNotifications()">notifications</span>
        <div class="avatar">{{ (user.first_name[0]|upper) if user.first_name else 'U' }}</div>
      </div>
    </header>

    <div class="container">

      <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–ª–æ–∫ -->
      <div class="card highlight" id="welcome-card">
        <div class="subscription-badge" id="sub-badge">–ë–∞–∑–æ–≤–∞—è</div>
        <h2>üå± –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –õ–µ–æ</h2>
        <p>–í–∞—à –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ Telegram. –ó–¥–µ—Å—å ‚Äî –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ.</p>
        <button class="btn-primary" onclick="navigateTo('premium')">
          {{ '–£–ø—Ä–∞–≤–ª—è—Ç—å' if user.is_premium else '–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–º–∏—É–º' }}
        </button>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
      <div class="section-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
      <div class="button-grid">
        <a href="/finance?user_id={{ user.id }}&hash={{ request.query_params.hash }}" class="action-btn">
          <div class="action-icon">üí∞</div>
          <div class="action-label">–§–∏–Ω–∞–Ω—Å—ã</div>
        </a>
        <a href="#" class="action-btn" onclick="navigateTo('weather')">
          <div class="action-icon">üå¶</div>
          <div class="action-label">–ü–æ–≥–æ–¥–∞</div>
        </a>
        <a href="#" class="action-btn" onclick="navigateTo('gigachat')">
          <div class="action-icon">üí¨</div>
          <div class="action-label">GigaChat</div>
        </a>
        <a href="#" class="action-btn" onclick="navigateTo('games')">
          <div class="action-icon">üéÆ</div>
          <div class="action-label">–ò–≥—Ä—ã</div>
        </a>
      </div>

      <!-- –í–∏–¥–∂–µ—Ç—ã: –ø–æ–≥–æ–¥–∞, –∫—É—Ä—Å—ã, —á–∞—Ç, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
      <div class="widget-grid">
        
        <!-- –ü–æ–≥–æ–¥–∞ -->
        <div class="widget weather-widget">
          <div class="widget-icon">üå§</div>
          <div class="widget-title">–ü–æ–≥–æ–¥–∞</div>
          <div class="widget-value"><span id="current-temp">+12¬∞C</span></div>
          <div class="widget-sub">–≤ –ú–æ—Å–∫–≤–µ</div>
        </div>

        <!-- –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç -->
        <div class="widget currency-widget">
          <div class="widget-icon">üíµ</div>
          <div class="widget-title">–ö—É—Ä—Å USD</div>
          <div class="widget-value"><span id="usd-rate">98.50</span> ‚ÇΩ</div>
          <div class="widget-sub">–Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
        </div>

        <!-- GigaChat -->
        <div class="widget chat-widget">
          <div class="widget-icon">ü§ñ</div>
          <div class="widget-title">GigaChat</div>
          <div class="widget-value">{{ user.gigachat_requests or 0 }}/10</div>
          <div class="widget-sub">–∑–∞–ø—Ä–æ—Å–æ–≤</div>
        </div>

        <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
        <div class="widget reminder-widget">
          <div class="widget-icon">üõé</div>
          <div class="widget-title">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
          <div class="widget-value">{{ user.reminders or 2 }}</div>
          <div class="widget-sub">–∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
        </div>
      </div>

      <!-- –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
      <div class="section-title">üì∞ –ù–æ–≤–æ—Å—Ç–∏ –¥–Ω—è</div>
      <div class="news-feed" id="news-feed">
        <!-- –ù–æ–≤–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ "–ï—â—ë" -->
      <div class="news-footer">
        <button class="btn-sm" onclick="loadMoreNews()">–ï—â—ë –Ω–æ–≤–æ—Å—Ç–∏</button>
      </div>

    </div>
  </div>

  <!-- FAB -->
  <button class="fab" onclick="navigateTo('gigachat')">üí¨</button>

  <!-- –û–≤–µ—Ä–ª–µ–π -->
  <div class="overlay" onclick="toggleSidebar()"></div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã -->
  <script src="/static/js/main.js?v=9"></script>
  <script>
    // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userData = {
      id: {{ user.id if user.id else 'null' }},
      firstName: "{{ user.first_name|default('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', true) }}",
      isPremium: {{ "true" if user.is_premium else "false" }},
      role: "{{ user.role|default('user', true) }}",
      gigachat_requests: {{ user.gigachat_requests if user.gigachat_requests else 0 }},
      reminders: {{ user.reminders if user.reminders else 2 }}
    };

    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
    function updateGreeting() {
      const hour = new Date().getHours();
      const map = { 5: "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ", 12: "–î–æ–±—Ä—ã–π –¥–µ–Ω—å", 18: "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä", 22: "–î–æ–±—Ä–æ–π –Ω–æ—á–∏" };
      const icons = { 5: "‚òÄÔ∏è", 12: "üå§", 18: "üåô", 22: "üò¥" };
      let g = "–ü—Ä–∏–≤–µ—Ç", i = "üôÇ";
      for (const h in map) if (hour >= h) { g = map[h]; i = icons[h]; }
      document.getElementById('greeting').textContent = g;
      document.getElementById('mood-icon').textContent = i;
    }

    // –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
    const badge = document.getElementById('sub-badge');
    if (badge) {
      if (userData.isPremium) {
        badge.textContent = '–ü—Ä–µ–º–∏—É–º';
        badge.style.background = '#DAA520';
      } else {
        badge.textContent = '–ë–∞–∑–æ–≤–∞—è';
        badge.style.background = '#4CAF50';
      }
    }

    // –ü–æ–∫–∞–∑ –∞–¥–º–∏–Ω–∫–∏
    if (userData.role === 'admin' && document.getElementById('admin-link')) {
      document.getElementById('admin-link').style.display = 'flex';
    }

    // === –ù–û–í–û–°–¢–ò ===
    const mockNews = [
      { icon: "üåç", title: "–ö—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –ø—Ä–µ–≤—ã—Å–∏–ª 99 —Ä—É–±–ª–µ–π", time: "10 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
      { icon: "ü§ñ", title: "Sber –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é GigaChat", time: "35 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
      { icon: "üå§", title: "–í –ú–æ—Å–∫–≤–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ –¥–æ +14¬∞C", time: "1 —á–∞—Å –Ω–∞–∑–∞–¥" },
      { icon: "üí∞", title: "–¶–ë –†–§ –æ–±—ä—è–≤–∏–ª –æ –Ω–æ–≤—ã—Ö –º–µ—Ä–∞—Ö –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä—É–±–ª—è", time: "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" },
      { icon: "üì±", title: "Telegram –æ–±–Ω–æ–≤–∏–ª —Ñ—É–Ω–∫—Ü–∏—é Mini Apps", time: "3 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" },
      { icon: "‚ö°", title: "–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –≤ –†–§", time: "4 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" }
    ];

    function renderNews(count = 3) {
      const container = document.getElementById('news-feed');
      if (!container) return;
      container.innerHTML = '';

      const toShow = mockNews.slice(0, count);
      toShow.forEach(news => {
        const item = document.createElement('div');
        item.className = 'news-item';
        item.innerHTML = `
          <div class="news-icon">${news.icon}</div>
          <div class="news-content">
            <div class="news-title">${news.title}</div>
            <div class="news-time">${news.time}</div>
          </div>
        `;
        container.appendChild(item);
      });
    }

    function loadMoreNews() {
      const currentCount = document.querySelectorAll('.news-item').length;
      const nextCount = Math.min(currentCount + 3, mockNews.length);
      renderNews(nextCount);
    }

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', () => {
      updateGreeting();
      renderNews(3);
    });
  </script>
</body>
</html>