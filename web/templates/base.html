<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–õ–µ–æ –ü–æ–º–æ—â–Ω–∏–∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">

    <!-- üî¥ –í–°–¢–†–û–ï–ù–ù–´–ô CSS ‚Äî –° –≠–ö–†–ê–ù–ò–†–û–í–ê–ù–ò–ï–ú –î–õ–Ø JINJA2 -->
    {% raw %}
    <style>
      /* === –§–û–†–°–ò–†–û–í–ê–ù–ù–ê–Ø –®–ê–ü–ö–ê === */
      #combined-header {
        position: sticky !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1000 !important;
        background: rgba(255, 255, 255, 0.96) !important;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(220, 255, 240, 0.9)) !important;
        backdrop-filter: blur(12px) !important;
        -webkit-backdrop-filter: blur(12px) !important;
        border-bottom: 1px solid rgba(76, 175, 80, 0.12) !important;
        transition: transform 0.3s ease !important;
      }

      [data-theme="dark"] #combined-header {
        background: rgba(13, 17, 23, 0.96) !important;
        background: linear-gradient(145deg, rgba(13, 17, 23, 0.98), rgba(18, 24, 33, 0.9)) !important;
        border-color: rgba(178, 255, 89, 0.16) !important;
      }

      #combined-header.hidden {
        transform: translateY(-100%) !important;
      }

      .header-container {
        width: 100% !important;
        max-width: 600px !important;
        margin: 0 auto !important;
        padding: 0 16px !important;
        height: 60px !important;
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        gap: 12px !important;
      }

      .header-left,
      .header-right {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
        flex-shrink: 0 !important;
      }

      .app-icon-wrapper {
        width: 36px !important;
        height: 36px !important;
        border-radius: 12px !important;
        overflow: hidden !important;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1) !important;
      }

      .app-icon {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
      }

      #menu-btn,
      #theme-toggle {
        width: 40px !important;
        height: 40px !important;
        border-radius: 50% !important;
        background: transparent !important;
        border: none !important;
        color: #4CAF50 !important;
        cursor: pointer !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
      }

      #theme-toggle {
        background: #ffffff !important;
        border: 1px solid rgba(76, 175, 80, 0.12) !important;
      }

      [data-theme="dark"] #theme-toggle {
        background: #121821 !important;
        border-color: rgba(178, 255, 89, 0.16) !important;
        color: #B2FF59 !important;
      }

      #menu-btn:hover,
      #theme-toggle:hover {
        background: #e8f5e9 !important;
      }

      .page-title {
        flex: 1 !important;
        text-align: center !important;
        font-weight: 600 !important;
        font-size: 1.1em !important;
        color: #212121 !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        margin: 0 8px !important;
      }

      [data-theme="dark"] .page-title {
        color: #e0f7ff !important;
      }

      .user-avatar {
        width: 36px !important;
        height: 36px !important;
        border-radius: 50% !important;
        border: 2px solid #4CAF50 !important;
        object-fit: cover !important;
        box-shadow: 0 0 0 2px #ffffff !important;
      }

      [data-theme="dark"] .user-avatar {
        border-color: #B2FF59 !important;
        box-shadow: 0 0 0 2px #0d1117 !important;
      }

      /* === –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) === */
      :root {
        --accent: #4CAF50;
        --accent-light: #B2FF59;
        --bg-primary: #f8fbf8;
        --bg-secondary: #ffffff;
        --bg-hover: #e8f5e9;
        --bg-dark: #0d1117;
        --bg-dark-secondary: #121821;
        --bg-dark-hover: #161f2b;
        --text-primary: #212121;
        --text-secondary: #757575;
        --text-dark: #e0f7ff;
        --border-light: rgba(76, 175, 80, 0.12);
        --border-dark: rgba(178, 255, 89, 0.16);
        --gold: #DAA520;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-dark: 0 0 0 1px rgba(178, 255, 89, 0.15);
        --transition: all 0.3s ease;
      }

      [data-theme="dark"] {
        --bg-primary: var(--bg-dark);
        --bg-secondary: var(--bg-dark-secondary);
        --bg-hover: var(--bg-dark-hover);
        --text-primary: var(--text-dark);
        --text-secondary: #88c0d0;
        --accent: #B2FF59;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Inter', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        padding: 0;
        margin: 0;
        line-height: 1.6;
      }

      .btn-primary {
        background: var(--accent);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 4px 14px rgba(76, 175, 80, 0.3);
        transition: var(--transition);
        margin-top: 12px;
        display: inline-block;
        text-align: center;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(76, 175, 80, 0.4);
      }

      .btn-sm {
        background: #c8e6c9;
        color: #2e7d32;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        width: 100%;
        margin-top: 12px;
      }

      .card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        border-radius: 16px;
        padding: 24px;
        box-shadow: var(--shadow);
        margin-bottom: 24px;
      }

      [data-theme="dark"] .card {
        background: var(--bg-dark-secondary);
        border-color: var(--border-dark);
        color: var(--text-primary);
      }

      .button-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin: 16px 0;
      }

      .action-btn {
        text-decoration: none;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        color: var(--text-primary);
        padding: 18px;
        border-radius: 16px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        transition: var(--transition);
      }

      .action-btn:hover {
        background: var(--bg-hover);
        transform: translateY(-4px);
      }

      [data-theme="dark"] .action-btn {
        background: var(--bg-dark-secondary);
        border-color: var(--border-dark);
        color: var(--accent-light);
      }

      .action-icon {
        font-size: 28px;
      }

      .action-label {
        font-size: 15px;
      }

      .dual-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin: 24px 0;
      }

      .stat-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
      }

      [data-theme="dark"] .stat-card {
        background: var(--bg-dark-secondary);
        border-color: var(--border-dark);
      }

      .stat-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--accent);
        margin: 0 0 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .stat-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed var(--border-light);
        font-size: 14px;
      }

      .stat-label {
        color: var(--text-secondary);
      }

      .stat-value {
        font-weight: 500;
        color: var(--text-primary);
      }

      .stat-change {
        color: var(--accent);
        font-size: 12px;
        margin-left: 6px;
      }

      .section-title {
        font-size: 16px;
        color: var(--accent);
        margin: 24px 0 12px;
        font-weight: 600;
      }

      .news-feed {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .news-item {
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        border-radius: 8px;
        padding: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }

      [data-theme="dark"] .news-item {
        background: var(--bg-dark-secondary);
        border-color: var(--border-dark);
      }

      .news-icon {
        font-size: 20px;
        color: var(--accent);
      }

      .news-title {
        font-size: 15px;
        font-weight: 500;
        color: var(--text-primary);
        margin: 0;
      }

      .news-time {
        font-size: 12px;
        color: var(--text-secondary);
      }

      #toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
        font-size: 14px;
        white-space: nowrap;
      }

      #toast.show {
        opacity: 1;
      }

      .main-content {
        margin-top: 60px;
        padding: 0 16px;
        min-height: calc(100vh - 60px);
      }

      /* === –£–î–ê–õ–ï–ù–ù–´–ï –ú–ï–î–ò–ê-–ó–ê–ü–†–û–°–´ (–≤—Ä–µ–º–µ–Ω–Ω–æ) === */
      /* –£–¥–∞–ª–µ–Ω—ã @media (max-width: 768px) –∏ (max-width: 480px) */
      /* –ß—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
    </style>
    {% endraw %}
</head>
<body>
    <!-- –®–∞–ø–∫–∞ ‚Äî –±–µ–∑ style="", —Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å—ã -->
    <header id="combined-header">
        <div class="header-container">
            <!-- –õ–ï–í–ê–Ø –ß–ê–°–¢–¨ -->
            <div class="header-left">
                <div class="app-icon-wrapper">
                    <img src="/static/favicon.ico" alt="–õ–µ–æ" class="app-icon">
                </div>
                <button class="btn-icon" id="menu-btn">
                    <span class="material-icons">menu</span>
                </button>
            </div>

            <!-- –¶–ï–ù–¢–† -->
            <div class="page-title">
                {{ page_title | default("–ì–ª–∞–≤–Ω–∞—è") }}
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ -->
            <div class="header-right">
                <button class="btn-icon" id="theme-toggle">
                    <span class="material-icons" id="theme-icon">dark_mode</span>
                </button>
                <img src="{{ user.get('avatar_url', '/static/img/avatar-placeholder.png') }}" alt="User" class="user-avatar">
            </div>
        </div>
    </header>

    <div class="main-content">
        {% block content %}{% endblock %}
    </div>

    <div id="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <!-- üî• –í–°–¢–†–û–ï–ù–ù–´–ô JS ‚Äî –ì–ê–†–ê–ù–¢–ò–Ø UTF-8 -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        console.log('‚úÖ DOM –∑–∞–≥—Ä—É–∂–µ–Ω');

        // --- –¢–µ–º–∞ ---
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const html = document.documentElement;

        const savedTheme =
          document.cookie.match(/theme=([^;]+)/)?.[1] ||
          localStorage.getItem('theme') ||
          'light';

        html.setAttribute('data-theme', savedTheme);
        themeIcon.textContent = savedTheme === 'dark' ? 'light_mode' : 'dark_mode';

        if (themeToggle) {
          themeToggle.onclick = () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            themeIcon.textContent = isDark ? 'dark_mode' : 'light_mode';
            localStorage.setItem('theme', newTheme);
            document.cookie = `theme=${newTheme}; path=/; max-age=31536000`;
            console.log('üåô –¢–µ–º–∞:', newTheme);
          };
        }

        // --- –°–∫—Ä—ã—Ç–∏–µ —à–∞–ø–∫–∏ ---
        const header = document.getElementById('combined-header');
        let lastScroll = 0;
        if (header) {
          window.addEventListener('scroll', () => {
            const current = window.scrollY;
            if (current > 100 && current > lastScroll) {
              header.classList.add('hidden');
            } else if (current < lastScroll && current > 50) {
              header.classList.remove('hidden');
            }
            lastScroll = current;
          });
        }

        // --- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é ---
        const menuBtn = document.getElementById('menu-btn');
        if (menuBtn) {
          menuBtn.onclick = () => {
            Toast.info("–ú–µ–Ω—é –Ω–∞–∂–∞—Ç–æ");
          };
        }

        // --- Toast ---
        window.Toast = {
          show: (msg) => {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = msg;
            toast.className = 'show';
            setTimeout(() => {
              toast.className = '';
            }, 3000);
          },
          info: (msg) => Toast.show(msg),
          success: (msg) => Toast.show(msg),
          warning: (msg) => Toast.show(msg),
          error: (msg) => Toast.show(msg)
        };

        // --- Telegram WebApp (–µ—Å–ª–∏ –≤ Telegram) ---
        if (window.Telegram?.WebApp) {
          window.Telegram.WebApp.ready();
          window.Telegram.WebApp.expand();
        }
      });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>