<!-- web/templates/partials/theme-toggle.html -->
<div class="theme-toggle-container">
  <button class="btn toggle-btn" id="theme-toggle" onclick="toggleTheme()">
    <span class="icon">üåô</span>
    <span class="label">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
  </button>
</div>

<script>
  function toggleTheme() {
    const btn = document.getElementById('theme-toggle');
    const icon = btn.querySelector('.icon');
    const label = btn.querySelector('.label');
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

    const newTheme = isDark ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);

    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    icon.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
    label.textContent = isDark ? '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—É–∫–∏
    document.cookie = `theme=${newTheme}; path=/; max-age=31536000`;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    const urlParams = new URLSearchParams(window.location.search);
    const user_id = urlParams.get('user_id');
    const hash = urlParams.get('hash');

    if (user_id && hash) {
      fetch('/api/set-theme', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: parseInt(user_id), theme: newTheme, hash })
      }).catch(console.warn);
    }
  }

  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
  document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = getCookie('theme') || '{{ theme }}' || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    const btn = document.getElementById('theme-toggle');
    if (btn) {
      const icon = btn.querySelector('.icon');
      const label = btn.querySelector('.label');
      if (savedTheme === 'dark') {
        icon.textContent = '‚òÄÔ∏è';
        label.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
      }
    }
  });

  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
  }
</script>